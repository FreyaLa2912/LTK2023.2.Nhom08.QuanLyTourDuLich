<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
  <meta name="author" content="AdminKit">
  <meta name="keywords"
    content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="shortcut icon" href="img/icons/icon-48x48.png" />

  <link rel="canonical" href="https://demo-basic.adminkit.io/" />

  <title>Quản lý - BrownDuckTour</title>

  <link href="css/app.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar" class="sidebar js-sidebar">
      <div class="sidebar-content js-simplebar">
        <div class="sidebar-brand">
          <br class="align-middle">BrownDuckTour
          </br>
          Quản lý
        </div>

        <ul class="sidebar-nav">
          <li class="sidebar-item active">
            <a class="sidebar-link" href="indexAdmin.html">
              <i class="align-middle" data-feather="sliders"></i>
              <span class="align-middle">Thống kê</span>
            </a>
          </li>

          <li class="sidebar-header">
            TÍNH NĂNG QUẢN LÝ
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="QLTour.html">
              <i class="align-middle" data-feather="navigation"></i>
              <span class="align-middle">Tour / Lịch trình</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="QLBanDo.html">
              <i class="align-middle" data-feather="map"></i>
              <span class="align-middle">Bản đồ</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="QLDiaDiem.html">
              <i class="align-middle" data-feather="map-pin"></i>
              <span class="align-middle">Địa điểm</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="QLDotTour.html">
              <i class="align-middle" data-feather="list"></i>
              <span class="align-middle">Đợt Tour</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="QLDonDatTour.html">
              <i class="align-middle" data-feather="file-text"></i>
              <span class="align-middle">Đơn đặt Tour</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="QLNguoiDung.html">
              <i class="align-middle" data-feather="user"></i>
              <span class="align-middle">Tài khoản người dùng</span>
            </a>
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="QLHuongDanVien.html">
              <i class="align-middle" data-feather="users"></i>
              <span class="align-middle">Hướng dẫn viên</span>
            </a>
          </li>

          <li class="sidebar-header">
            TÀI KHOẢN
          </li>

          <li class="sidebar-item">
            <a class="sidebar-link" href="index.html">
              <i class="align-middle" data-feather="log-in"></i>
              <span class="align-middle">Đăng xuất</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="main">
      <nav class="navbar navbar-expand navbar-light navbar-bg">
        <a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>
      </nav>

      <main class="content">
        <div class="container-fluid p-0">

          <h1 class="h3 mb-3">
            <strong>Biểu đồ thống kê</h1>

          <div class="row">
            <div class="col-xl-6 col-xxl-5 d-flex">
              <div class="w-100">
                <div class="row">
                  <div class="col-sm-6">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col mt-0">
                            <h5 class="card-title">Doanh thu</h5>
                          </div>

                          <div class="col-auto">
                            <div class="stat text-primary">
                              <i class="align-middle" data-feather="dollar-sign"></i>
                            </div>
                          </div>
                        </div>
                        <h1 class="mt-1 mb-3" id="tongDoanhThu"></h1>
                        <div class="mb-0">
                          <span class="text-success">
                            <i class="mdi mdi-arrow-bottom-right"></i>
                            <span id="tyLeTangTruongDoanhThu"></span>
                          </span>
                          <span class="text-muted">So với tuần trước</span>
                        </div>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col mt-0">
                            <h5 class="card-title">Lượt đặt tour</h5>
                          </div>

                          <div class="col-auto">
                            <div class="stat text-primary">
                              <i class="align-middle" data-feather="shopping-cart"></i>
                            </div>
                          </div>
                        </div>
                        <h1 class="mt-1 mb-3" id="tongLuotDatTour"></h1>
                        <div class="mb-0">
                          <span class="text-danger">
                            <i class="mdi mdi-arrow-bottom-right"></i>
                            <span id="tyLeTangTruongLuotDat"></span>
                          </span>
                          <span class="text-muted">So với tuần trước</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col mt-0">
                            <h5 class="card-title">Số lượng tour</h5>
                          </div>

                          <div class="col-auto">
                            <div class="stat text-primary">
                              <i class="align-middle" data-feather="briefcase"></i>
                            </div>
                          </div>
                        </div>
                        <h1 class="mt-1 mb-3" id="tongSoTour"></h1>
                        <div class="mb-0">
                          <span class="text-success">
                            <i class="mdi mdi-arrow-bottom-right"></i>
                            <span id="tyLeTangTruongSoTour"></span>
                          </span>
                          <span class="text-muted">So với tuần trước</span>
                        </div>
                      </div>
                    </div>
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col mt-0">
                            <h5 class="card-title">Số lượng địa điểm</h5>
                          </div>

                          <div class="col-auto">
                            <div class="stat text-primary">
                              <i class="align-middle" data-feather="map-pin"></i>
                            </div>
                          </div>
                        </div>
                        <h1 class="mt-1 mb-3" id="tongSoDiaDiem"></h1>
                        <div class="mb-0">
                          <span class="text-danger">
                            <i class="mdi mdi-arrow-bottom-right"></i>
                            <span id="tyLeTangTruongSoDiaDiem"></span>
                          </span>
                          <span class="text-muted">So với tuần trước</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xl-6 col-xxl-7">
              <div class="card flex-fill w-100">
                <div class="card-header">
                  <h5 class="card-title mb-0">Biểu đồ doanh thu</h5>
                </div>
                <div class="card-body py-3">
                  <div class="chart chart-sm">
                    <canvas id="chartjs-dashboard-line"></canvas>
                  </div>
                </div>
              </div>
              
            </div>
          </div>

          <div class="row">
            <div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-3">
              <div class="card flex-fill w-100">
                <div class="card-header">
                  <h5 class="card-title mb-0">Tỉ lệ lượt đặt tour theo trạng thái</h5>
                </div>
                <div class="card-body d-flex">
                  <div class="align-self-center w-100">
                    <div class="py-3">
                      <div class="chart chart-xs">
                        <canvas id="chartjs-dashboard-pie"></canvas>
                      </div>
                    </div>

                    <table class="table mb-0">
                      <tbody>
                        <tr>
                          <td>
                            <i class="fas fa-circle text-primary fa-fw"></i> Đã xác nhận
                          </td>
                          <td class="text-end" id="daXacNhan"></td>
                        </tr>
                        <tr>
                          <td>
                            <i class="fas fa-circle text-warning fa-fw"></i> Đang chờ
                          </td>
                          <td class="text-end" id="dangCho"></td>
                        </tr>
                        <tr>
                          <td>
                            <i class="fas fa-circle text-danger fa-fw"></i> Đã hủy
                          </td>
                          <td class="text-end" id="daHuy"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container-fluid">
            <div class="row text-muted">
                <div class="col-6 text-start">
                    <p class="mb-0">
                        <a class="text-muted">
                            <strong>Đồ án</strong>
                        </a>
                        -
                        <a class="text-muted">
                            <strong>Hệ thống thông tin địa lý ba chiều</strong>
                        </a>
                        &copy;
                    </p>
                </div>
                <div class="col-6 text-end">
                    <a class="text-muted">
                        <strong>Ứng dụng quản lý tour cho công ty du lịch (2D)</strong>
                    </a>
                </div>
            </div>
        </div>
    </footer>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Gọi API để lấy dữ liệu thống kê
    fetch('http://localhost:8080/api/thongke')
      .then(response => {
        if (!response.ok) {
          throw new Error('Lỗi khi lấy dữ liệu thống kê');
        }
        return response.json();
      })
      .then(data => {
        // Cập nhật các giá trị vào trang web
        document.getElementById('tongDoanhThu').textContent = data.tongDoanhThu.toLocaleString(); // Format doanh thu
        document.getElementById('tyLeTangTruongDoanhThu').textContent = `${data.tyLeTangTruongDoanhThu}%`;
        document.getElementById('tongLuotDatTour').textContent = data.tongLuotDatTour;
        document.getElementById('tyLeTangTruongLuotDat').textContent = `${data.tyLeTangTruongLuotDat}%`;
        document.getElementById('tongSoTour').textContent = data.tongSoTour;
        document.getElementById('tyLeTangTruongSoTour').textContent = `${data.tyLeTangTruongSoTour}%`;
        document.getElementById('tongSoDiaDiem').textContent = data.tongSoDiaDiem;
        document.getElementById('tyLeTangTruongSoDiaDiem').textContent = `${data.tyLeTangTruongSoDiaDiem}%`;

        // Cập nhật biểu đồ doanh thu
        new Chart(document.getElementById("chartjs-dashboard-line"), {
          type: "line",
          data: {
            labels: data.bieuDoDoanhThu.labels,
            datasets: [{
              label: "Doanh thu",
              fill: true,
              backgroundColor: "rgba(215, 227, 244, 1)",
              borderColor: window.theme.primary,
              data: data.bieuDoDoanhThu.data
            }]
          },
          options: {
            maintainAspectRatio: false,
            legend: {
              display: false
            },
            tooltips: {
              intersect: false
            },
            hover: {
              intersect: true
            },
            plugins: {
              filler: {
                propagate: false
              }
            },
            scales: {
              xAxes: [{
                reverse: true,
                gridLines: {
                  color: "rgba(0,0,0,0.0)"
                }
              }],
              yAxes: [{
                ticks: {
                  stepSize: 1000
                },
                display: true,
                borderDash: [3, 3],
                gridLines: {
                  color: "rgba(0,0,0,0.0)"
                }
              }]
            }
          }
        });

        // Cập nhật biểu đồ tỉ lệ lượt đặt tour theo trạng thái
        new Chart(document.getElementById("chartjs-dashboard-pie"), {
          type: "pie",
          data: {
            labels: ['Đã xác nhận', 'Đang chờ', 'Đã hủy'], // Thay thế bằng các trạng thái thực tế
            datasets: [{
              data: [
                data.tiLeLuotDatTheoTrangThai['Đã xác nhận'],
                data.tiLeLuotDatTheoTrangThai['Đang chờ'],
                data.tiLeLuotDatTheoTrangThai['Đã hủy']
              ],
              backgroundColor: [
                window.theme.primary,
                window.theme.warning,
                window.theme.danger
              ],
              borderWidth: 5
            }]
          },
          options: {
            responsive: !window.MSInputMethodContext,
            maintainAspectRatio: false,
            legend: {
              display: false
            },
            cutoutPercentage: 75
          }
        });

        // Hiển thị số liệu cụ thể cho biểu đồ tỉ lệ lượt đặt tour
        document.getElementById('daXacNhan').textContent = `${data.tiLeLuotDatTheoTrangThai['Đã xác nhận']}`;
        document.getElementById('dangCho').textContent = `${data.tiLeLuotDatTheoTrangThai['Đang chờ']}`;
        document.getElementById('daHuy').textContent = `${data.tiLeLuotDatTheoTrangThai['Đã hủy']}`;
      })
      .catch(error => {
        console.error('Lỗi khi lấy dữ liệu thống kê:', error);
        alert('Không thể lấy dữ liệu thống kê. Vui lòng thử lại sau!');
      });
  </script>
</body>

</html>