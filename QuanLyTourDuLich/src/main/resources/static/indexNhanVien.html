<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta
            name="description"
            content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
        <meta name="author" content="AdminKit">

        <meta
            name="keywords"
            content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

        <link rel="shortcut icon" href="img/icons/icon-48x48.png"/>

        <link rel="canonical" href="https://demo-basic.adminkit.io/"/>

        <title>Nhân viên - Đặt Tour</title>

        <link href="css/app.css" rel="stylesheet">
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap"
            rel="stylesheet">
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet">
    </head>

    <body>
        <div class="wrapper">
            <nav id="sidebar" class="sidebar js-sidebar">
                <div class="sidebar-content js-simplebar">
                    <div class="sidebar-brand">
                        <br class="align-middle">BrownDuckTour
                        </br>
                        Nhân viên</span>
                </div>

                <ul class="sidebar-nav">
                    <li class="sidebar-item active">
                        <a class="sidebar-link" href="indexNhanVien.html">
                            <i class="align-middle" data-feather="list"></i>
                            <span class="align-middle">Tour & Lịch trình</span>
                        </a>
                    </li>

                    <li class="sidebar-header">
                        TÍNH NĂNG
                    </li>
                    <li class="sidebar-item">
                        <a class="sidebar-link" href="QLDonDatTourNhanVien.html">
                            <i class="align-middle" data-feather="file-text"></i>
                            <span class="align-middle">Đơn đặt Tour</span>
                        </a>
                    </li>
                    <li class="sidebar-header">
                        TÀI KHOẢN
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="index.html">
                            <i class="align-middle" data-feather="log-in"></i>
                            <span class="align-middle">Đăng xuất</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="main">
            <nav class="navbar navbar-expand navbar-light navbar-bg">
                <a class="sidebar-toggle js-sidebar-toggle">
                    <i class="hamburger align-self-center"></i>
                </a>
            </nav>

            <main class="content">
                <div class="container-fluid p-0">

                    <h1 class="h3 mb-3">
                        <strong>Danh sách Tour và Lịch Trình</strong>
                    </h1>

                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Danh sách Tour</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-striped" id="tourTable">
                                        <thead>
                                            <tr>
                                                <th>Mã tour</th>
                                                <th>Tên tour</th>
                                                <th>Mô tả</th>
                                                <th>Số ngày</th>
                                                <th>Địa điểm khởi hành</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Lịch trình Tour</h5>
                                </div>
                                <div class="card-body">
                                    <div id="lichTrinhContainer"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row text-muted">
                        <div class="col-6 text-start">
                            <p class="mb-0">
                                <a class="text-muted">
                                    <strong>Đồ án</strong>
                                </a>
                                -
                                <a class="text-muted">
                                    <strong>Hệ thống thông tin địa lý ba chiều</strong>
                                </a>
                                &copy;
                            </p>
                        </div>
                        <div class="col-6 text-end">
                            <a class="text-muted">
                                <strong>Ứng dụng quản lý tour cho công ty du lịch (2D)</strong>
                            </a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Gọi API để lấy danh sách tour
    fetch('http://localhost:8080/api/tours')
      .then(response => {
        if (!response.ok) {
          throw new Error('Lỗi khi lấy danh sách tour');
        }
        return response.json();
      })
      .then(tours => {
        const tbody = document.querySelector('#tourTable tbody');
        tbody.innerHTML = ''; 

        tours.forEach(tour => {
          const row = document.createElement('tr');
          row.innerHTML = `
                <td>${tour.maTour}</td>
                <td>${tour.tenTour}</td>
                <td>${tour.moTa}</td>
                <td>${tour.soNgay}</td>
                <td>${tour.diaDiem.tenDiaDiem}</td> 
            `;
          tbody.appendChild(row);

          // Gọi API để lấy lịch trình của tour
          fetch(`http://localhost:8080/api/tours/${tour.maTour}/lichtrinhtours`)
  .then(response => {
    if (!response.ok) {
      throw new Error('Lỗi khi lấy danh sách lịch trình tour');
    }
    return response.json();
  })
  .then(lichTrinhTours => {
    if (!Array.isArray(lichTrinhTours)) {
      throw new Error('Dữ liệu lịch trình tour không hợp lệ');
    }

    const lichTrinhDiv = document.createElement('div');
    lichTrinhDiv.innerHTML = `
                <h3>Lịch trình cho tour: ${tour.tenTour}</h3>
                <ul>
                ${lichTrinhTours.map(lichTrinh => {
                  // Kiểm tra lichTrinh.diaDiem trước khi truy cập tenDiaDiem
                
                  return `<li>${lichTrinh.moTa} </li>`;
                }).join('')}
                </ul>
            `;
    document.getElementById('lichTrinhContainer').appendChild(lichTrinhDiv);
  })
  .catch(error => {
    console.error("Lỗi khi lấy lịch trình tour:", error);
  });
        });
      })
      .catch(error => {
        console.error('Lỗi khi lấy danh sách tour:', error);
        alert('Không thể lấy danh sách tour. Vui lòng thử lại sau!');
      });
  </script>
</body>

</html>